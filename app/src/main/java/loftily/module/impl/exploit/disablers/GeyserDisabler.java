package loftily.module.impl.exploit.disablers;

import io.netty.buffer.Unpooled;
import loftily.event.impl.packet.PacketSendEvent;
import loftily.module.impl.exploit.Disabler;
import loftily.utils.client.PacketUtils;
import loftily.value.impl.mode.Mode;
import net.lenni0451.lambdaevents.EventHandler;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.CPacketCustomPayload;
import net.minecraft.network.play.client.CPacketPlayer;

import java.io.ByteArrayOutputStream;
import java.io.DataOutputStream;
import java.io.IOException;

public class GeyserDisabler extends Mode<Disabler> {
    public GeyserDisabler() {
        super("Geyser");
    }

    @EventHandler
    public void onPacketSend(PacketSendEvent event) throws IOException {
        if (event.getPacket() instanceof CPacketPlayer){
            if(mc.player.ticksExisted % 5 == 0){
                try {
                    ByteArrayOutputStream b = new ByteArrayOutputStream();
                    DataOutputStream _out = new DataOutputStream(b);
                    _out.writeUTF(mc.player.getGameProfile().getName());
                    PacketBuffer buf = new PacketBuffer(Unpooled.buffer());
                    buf.writeBytes(b.toByteArray());
                    PacketUtils.sendPacket(new CPacketCustomPayload("geyser", buf),false);
                }catch (IOException e){
                    e.printStackTrace();
                }
            }
        }
    }
}
