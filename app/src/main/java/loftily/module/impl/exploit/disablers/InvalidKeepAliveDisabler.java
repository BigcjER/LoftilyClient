package loftily.module.impl.exploit.disablers;

import loftily.event.impl.packet.PacketSendEvent;
import loftily.event.impl.world.UpdateEvent;
import loftily.module.impl.exploit.Disabler;
import loftily.utils.client.PacketUtils;
import loftily.utils.math.RandomUtils;
import loftily.value.impl.BooleanValue;
import loftily.value.impl.mode.Mode;
import net.lenni0451.lambdaevents.EventHandler;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketKeepAlive;

public class InvalidKeepAliveDisabler extends Mode<Disabler> {
    private final BooleanValue cancelEventC00 = new BooleanValue("InvalidKeepAlive-CancelEventC00", false);

    public InvalidKeepAliveDisabler() {
        super("InvalidKeepAlive");
    }

    @EventHandler
    public void onUpdate(UpdateEvent event) {
        PacketUtils.sendPacket(new CPacketKeepAlive(RandomUtils.randomInt(-999999, 999999)), false);
    }

    @EventHandler
    public void onPacketSend(PacketSendEvent event) {
        Packet<?> packet = event.getPacket();
        if (packet instanceof CPacketKeepAlive && cancelEventC00.getValue()) {
            event.setCancelled(true);
        }
    }
}
