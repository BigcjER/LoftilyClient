package loftily.module.impl.exploit.disablers;

import loftily.event.impl.packet.PacketReceiveEvent;
import loftily.module.impl.exploit.Disabler;
import loftily.utils.client.PacketUtils;
import loftily.value.impl.BooleanValue;
import loftily.value.impl.mode.Mode;
import net.lenni0451.lambdaevents.EventHandler;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketConfirmTeleport;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.server.SPacketPlayerPosLook;

public class FlagDisabler extends Mode<Disabler> {
    private final BooleanValue sendTPConfirm = new BooleanValue("SilentFlag-SendConfirmTP", false);
    private final BooleanValue sendC06 = new BooleanValue("SilentFlag-SendC06", false);
    
    public FlagDisabler() {
        super("SilentFlag");
    }
    
    @EventHandler
    public void onPacketReceive(PacketReceiveEvent event) {
        Packet<?> packet = event.getPacket();
        if (packet instanceof SPacketPlayerPosLook) {
            event.setCancelled(true);
            SPacketPlayerPosLook packetPlayerPosLook = (SPacketPlayerPosLook) packet;
            if (sendTPConfirm.getValue()) {
                PacketUtils.sendPacket(new CPacketConfirmTeleport(packetPlayerPosLook.getTeleportId()));
            }
            if (sendC06.getValue()) {
                PacketUtils.sendPacket(new CPacketPlayer.PositionRotation(
                        packetPlayerPosLook.getX(), packetPlayerPosLook.getY(), packetPlayerPosLook.getZ(),
                        packetPlayerPosLook.getYaw(), packetPlayerPosLook.getPitch(), false
                ));
            }
        }
    }
}
